

# ğŸ’ Musinsa Points API

> **ë¬´ë£Œ í¬ì¸íŠ¸ ì ë¦½/ì‚¬ìš©/ì·¨ì†Œ ê´€ë¦¬ ì‹œìŠ¤í…œ**  
> Spring Boot 3 + JPA + Caffeine Cache + Flyway ê¸°ë°˜ìœ¼ë¡œ ì„¤ê³„ëœ  
> ì•ˆì •ì ì´ê³  í™•ì¥ ê°€ëŠ¥í•œ **í¬ì¸íŠ¸ ê´€ë¦¬ ì„œë¹„ìŠ¤**ì…ë‹ˆë‹¤.

---

## ğŸ“š ëª©ì°¨
1. [í”„ë¡œì íŠ¸ ê°œìš”](#-í”„ë¡œì íŠ¸-ê°œìš”)
2. [ê¸°ìˆ  ìŠ¤íƒ](#-ê¸°ìˆ -ìŠ¤íƒ)
3. [ì•„í‚¤í…ì²˜ ê°œìš”](#-ì•„í‚¤í…ì²˜-ê°œìš”)
4. [ë„ë©”ì¸ ì„¤ê³„](#-ë„ë©”ì¸-ì„¤ê³„)
5. [ë¹Œë“œ ë° ì‹¤í–‰ ë°©ë²•](#-ë¹Œë“œ-ë°-ì‹¤í–‰-ë°©ë²•)
6. [API ì£¼ìš” ê¸°ëŠ¥](#-api-ì£¼ìš”-ê¸°ëŠ¥)
7. [í…ŒìŠ¤íŠ¸](#-í…ŒìŠ¤íŠ¸)
8. [ë””ë ‰í† ë¦¬ êµ¬ì¡°](#-ë””ë ‰í† ë¦¬-êµ¬ì¡°)
9. [í–¥í›„ ê°œì„  ì‚¬í•­](#-í–¥í›„-ê°œì„ -ì‚¬í•­)
10. [ì‘ì„±ì](#-ì‘ì„±ì)

---

## ğŸš€ í”„ë¡œì íŠ¸ ê°œìš”

- **ëª©ì :**  
  íšŒì›ì—ê²Œ ë¬´ë£Œ í¬ì¸íŠ¸ë¥¼ ë¶€ì—¬í•˜ê³ , ì‚¬ìš©/ì·¨ì†Œ/ì •ì±…ì„ ì•ˆì •ì ìœ¼ë¡œ ê´€ë¦¬í•˜ëŠ” ì‹œìŠ¤í…œ êµ¬ì¶•

- **í•µì‹¬ ëª©í‘œ:**
    - Append-Only íŠ¸ëœì­ì…˜ ê¸°ë°˜ ì„¤ê³„
    - ë©¤ë²„ë³„/ê¸€ë¡œë²Œ í¬ì¸íŠ¸ ì •ì±… ìºì‹± (Caffeine Cache)
    - í¬ì¸íŠ¸ ì ë¦½, ì ë¦½ ì·¨ì†Œ, ì‚¬ìš©, ì‚¬ìš© ì·¨ì†Œ, ì¬ì ë¦½(Regrant) ì§€ì›
    - ì •ì±… ë³€ê²½ ì‹œ ìºì‹œ ìë™ ë°˜ì˜
    - Flyway ê¸°ë°˜ DDL ê´€ë¦¬

---

## ğŸ›  ê¸°ìˆ  ìŠ¤íƒ

| êµ¬ë¶„ | ê¸°ìˆ                                  |
|------|------------------------------------|
| **ì–¸ì–´** | Java 21                            |
| **í”„ë ˆì„ì›Œí¬** | Spring Boot 3.5.7, Spring Data JPA |
| **DB** | H2 (ë¡œì»¬ í…ŒìŠ¤íŠ¸ìš©)                       |
| **ë¹Œë“œ ë„êµ¬** | Gradle 8.14.3                      |
| **ë§ˆì´ê·¸ë ˆì´ì…˜** | Flyway                             |
| **ìºì‹œ** | Caffeine Cache                     |
| **ë¬¸ì„œí™”** | Swagger (springdoc-openapi)        |
| **ë³´ì•ˆ** | Spring Security + JWT              |

---

## ğŸ— ì•„í‚¤í…ì²˜ ê°œìš”


	â€¢	Caffeine Cache: ë©¤ë²„ë³„ ë° ì „ì—­ ì •ì±…(pointPolicy) ìºì‹±
	â€¢	Flyway: ì´ˆê¸° í…Œì´ë¸” ë° mock ë°ì´í„° ìë™ ìƒì„±
	â€¢	Append-Only êµ¬ì¡°ì˜ point_historyë¡œ ëª¨ë“  ë³€ê²½ ì´ë ¥ ì¶”ì  ê°€ëŠ¥

## ğŸ§© ë„ë©”ì¸ ì„¤ê³„

| ì—”í‹°í‹° | ì„¤ëª… |
|--------|------|
| **Member** | íšŒì› ê¸°ë³¸ ì •ë³´ ë° ì—­í• (CUSTOMER, MANAGER) |
| **PointGrant** | í¬ì¸íŠ¸ ì ë¦½(ë¶€ì—¬) LOT ë‹¨ìœ„ â€” ë§Œë£Œì¼(expiresAt)ê³¼ ì”ì—¬ í¬ì¸íŠ¸(remainingAmount) ê´€ë¦¬ |
| **PointUse** | í¬ì¸íŠ¸ ì‚¬ìš© í—¤ë” â€” ì£¼ë¬¸ë²ˆí˜¸ ë‹¨ìœ„ ì‚¬ìš© ê¸°ë¡ (orderNo, usedAmount ë“±) |
| **PointUseDetail** | í¬ì¸íŠ¸ ì‚¬ìš© ìƒì„¸ â€” ê° ì ë¦½ LOT(PointGrant)ë³„ ì°¨ê° ë‚´ì—­ |
| **PointCancel** | í¬ì¸íŠ¸ ì‚¬ìš© ì·¨ì†Œ ë‚´ì—­ â€” ê¸°ì¡´ ì‚¬ìš© ìƒì„¸(PointUseDetail) ê¸°ë°˜ìœ¼ë¡œ ë¶€ë¶„/ì „ì²´ ì·¨ì†Œ |
| **PointHistory** | ëª¨ë“  í¬ì¸íŠ¸ ì´ë²¤íŠ¸(GRANT, USE, CANCEL, REGRANT ë“±)ì˜ append-only ë³€ê²½ ì´ë ¥ |
| **PointPolicy** | í¬ì¸íŠ¸ ì •ì±… ì„¤ì • â€” GLOBAL/íšŒì›ë³„ ì •ì±… ìºì‹± (MAX_GRANT_PER_TX, MAX_BALANCE_PER_MEMBER ë“±) |

> ê° ì—”í‹°í‹°ëŠ” DDD ê¸°ë°˜ìœ¼ë¡œ ì„¤ê³„ë˜ë©°, PointGrantë¥¼ ì œì™¸ ëª¨ë“  ë³€ê²½ì€ Append-Only êµ¬ì¡°ë¥¼ ë”°ë¦…ë‹ˆë‹¤.  
> `PointHistory`ë¥¼ í†µí•´ ëª¨ë“  ìƒíƒœ ë³€í™”ë¥¼ ì¶”ì í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## âš™ï¸ ë¹Œë“œ ë° ì‹¤í–‰ ë°©ë²•

### 1ï¸âƒ£ ì‚¬ì „ ìš”êµ¬ì‚¬í•­
- JDK **21 ì´ìƒ**
- Gradle **8.x ì´ìƒ**

### 2ï¸âƒ£ ì‹¤í–‰ ë°©ë²•

```bash
# 1. ë¹Œë“œ
./gradlew clean build

# 2. ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰
./gradlew bootRun
```
3ï¸âƒ£ Swagger ì ‘ì†

http://localhost:8080/swagger-ui/index.html


---

## ğŸ“¡ API ì£¼ìš” ê¸°ëŠ¥

| êµ¬ë¶„              | ê¸°ëŠ¥                                     | ì„¤ëª…                                                                              |
|-----------------|----------------------------------------|---------------------------------------------------------------------------------|
| âœ… **í¬ì¸íŠ¸ ë¶€ì—¬**    | **POST** `/api/v1/points/grant`        | í¬ì¸íŠ¸ ë¶€ì—¬ ë° ì •ì±… ê²€ì¦ (1íšŒ ìµœëŒ€ ì ë¦½ í•œë„, ë©¤ë²„ë³„ ìƒí•œì•¡ í™•ì¸) , ê´€ë¦¬ìì™€ ë³¸ì¸ë§Œ í¬ì¸íŠ¸ ë¶€ì—¬ (ë³¸ì¸ì´ í¬ì¸ë“œ ë°›ê¸°ë¥¼ ëˆ„ë¥¸ê±¸ ê°€ì •) |
| âœ… **í¬ì¸íŠ¸ ì·¨ì†Œ**    | **POST** `/api/v1/points/grant/cancel` | ì •ì±…ì— ë”°ë¥¸ í¬ì¸íŠ¸ ë¶€ì—¬ ì·¨ì†Œ(ì‚¬ìš©ëœ í¬ì¸íŠ¸ëŠ” ë¶€ì—¬ ì·¨ì†Œ ë¶ˆê°€)                                             |
| âœ… **í¬ì¸íŠ¸ ì‚¬ìš©**    | **POST** `/api/v1/points/use`          | ë§Œë£Œì¼ ê¸°ì¤€ FIFO ì°¨ê°, ì‚¬ìš© ì´ë ¥ ìƒì„± ë° ì ë¦½ LOTë³„ ìƒì„¸ ë§¤í•‘                                        |
| âœ… **í¬ì¸íŠ¸ ì‚¬ìš© ì·¨ì†Œ** | **POST** `/api/v1/points/use/cancel`   | ê¸°ì¡´ ì‚¬ìš© ìƒì„¸ ë‚´ì—­(PointUseDetail) ê¸°ë°˜ ë¶€ë¶„/ì „ì²´ ì·¨ì†Œ                                         |
| âœ… **í¬ì¸íŠ¸ ì •ì±… ê´€ë¦¬** | **PUT** `/api/v1/points/policy/member` | ë©¤ë²„ë³„ ë³´ìœ  ìƒí•œ ì •ì±… ê°±ì‹  ë° Caffeine Cache ìë™ ë°˜ì˜                                          |


> âš™ï¸ ëª¨ë“  APIëŠ” JWT ê¸°ë°˜ ì¸ì¦ í›„ ì ‘ê·¼ ê°€ëŠ¥í•˜ë©°, Swaggerë¥¼ í†µí•´ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
> Swagger ì£¼ì†Œ â†’ [http://localhost:8080/swagger-ui/index.html](http://localhost:8080/swagger-ui/index.html)

---

## ğŸ—‚ ë””ë ‰í† ë¦¬ êµ¬ì¡°
```bash
src/
 â”œâ”€â”€ main/java/musinsa/points
 â”‚   â”œâ”€â”€ application/          # ì„œë¹„ìŠ¤ ê³„ì¸µ (PointService, PointPolicyService ë“±)
 â”‚   â”œâ”€â”€ domain/               # ì—”í‹°í‹° ë° ë„ë©”ì¸ ë¡œì§
 â”‚   â”œâ”€â”€ infrastructure/       # Repository Adapter, Cache Adapter
 â”‚   â”œâ”€â”€ presentation/         # Controller (REST API)
 â”‚   â”œâ”€â”€ common/               # ê³µí†µ ìœ í‹¸, ì˜ˆì™¸, ë¡œê¹…, JWT
 â”‚   â””â”€â”€ PointsApplication.java
 â””â”€â”€ main/resources/
     â”œâ”€â”€ db/migration/         # Flyway SQL ìŠ¤í¬ë¦½íŠ¸
     â”œâ”€â”€ application.yml
     â””â”€â”€ static/swagger/

```
---

## ğŸ” í–¥í›„ ê°œì„  ì‚¬í•­

- âœ… **í¬ì¸íŠ¸ ë§Œë£Œ ìŠ¤ì¼€ì¤„ëŸ¬**
    - Quartz ë˜ëŠ” Spring Batch ê¸°ë°˜ìœ¼ë¡œ ë§Œë£Œ í¬ì¸íŠ¸ë¥¼ ìë™ ì†Œë©¸ ì²˜ë¦¬

- âœ… **Kafka ê¸°ë°˜ í¬ì¸íŠ¸ ì´ë²¤íŠ¸ ë¡œê·¸ ë¹„ë™ê¸° ì²˜ë¦¬**
    - Grant / Use / Cancel / Expire ì´ë²¤íŠ¸ë¥¼ Kafka í† í”½ìœ¼ë¡œ ë°œí–‰
    - Audit ë° ë¶„ì„ íŒŒì´í”„ë¼ì¸ê³¼ ì—°ë™

- âœ… **Redis ìºì‹œ ì „í™˜**
    - í˜„ì¬ Caffeine Cache â†’ Redisë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜
    - ë¶„ì‚° í™˜ê²½ì—ì„œì˜ ìºì‹œ ì¼ê´€ì„± í™•ë³´

- âœ… **MSA êµ¬ì¡° í™•ì¥**
    - `points-service` ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ `policy-service`, `history-service` ë“±ìœ¼ë¡œ ë¶„ë¦¬
    - ì„œë¹„ìŠ¤ ê°„ í†µì‹ ì€ gRPC ë˜ëŠ” Event ê¸°ë°˜ìœ¼ë¡œ ì „í™˜

- âœ… **PostgreSQL / Aurora ì „í™˜**
    - ë¡œì»¬ H2 â†’ PostgreSQL
    - ì´í›„ AWS Aurora PostgreSQL í´ëŸ¬ìŠ¤í„° í™˜ê²½ìœ¼ë¡œ í™•ì¥

---

## ğŸ‘¨â€ğŸ’» ì‘ì„±ì

| ì´ë¦„ | ì—­í•  | GitHub |
|------|------|--------|
| í•œì¤€í¬ | Backend Developer | [github.com/hanjunhui](https://github.com/hanjunhui) |


