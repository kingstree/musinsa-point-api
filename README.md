

# π’ Musinsa Points API

> **λ¬΄λ£ ν¬μΈνΈ μ λ¦½/μ‚¬μ©/μ·¨μ† κ΄€λ¦¬ μ‹μ¤ν…**  
> Spring Boot 3 + JPA + Caffeine Cache + Flyway κΈ°λ°μΌλ΅ μ„¤κ³„λ  
> μ•μ •μ μ΄κ³  ν™•μ¥ κ°€λ¥ν• **ν¬μΈνΈ κ΄€λ¦¬ μ„λΉ„μ¤**μ…λ‹λ‹¤.

---

## π“ λ©μ°¨
1. [ν”„λ΅μ νΈ κ°μ”](#-ν”„λ΅μ νΈ-κ°μ”)
2. [κΈ°μ  μ¤νƒ](#-κΈ°μ -μ¤νƒ)
3. [μ•„ν‚¤ν…μ² κ°μ”](#-μ•„ν‚¤ν…μ²-κ°μ”)
4. [λ„λ©”μΈ μ„¤κ³„](#-λ„λ©”μΈ-μ„¤κ³„)
5. [λΉλ“ λ° μ‹¤ν–‰ λ°©λ²•](#-λΉλ“-λ°-μ‹¤ν–‰-λ°©λ²•)
6. [API μ£Όμ” κΈ°λ¥](#-api-μ£Όμ”-κΈ°λ¥)
7. [ν…μ¤νΈ](#-ν…μ¤νΈ)
8. [λ””λ ‰ν† λ¦¬ κµ¬μ΅°](#-λ””λ ‰ν† λ¦¬-κµ¬μ΅°)
9. [ν–¥ν›„ κ°μ„  μ‚¬ν•­](#-ν–¥ν›„-κ°μ„ -μ‚¬ν•­)
10. [μ‘μ„±μ](#-μ‘μ„±μ)

---

## π€ ν”„λ΅μ νΈ κ°μ”

- **λ©μ :**  
  νμ›μ—κ² λ¬΄λ£ ν¬μΈνΈλ¥Ό λ¶€μ—¬ν•κ³ , μ‚¬μ©/μ·¨μ†/μ •μ±…μ„ μ•μ •μ μΌλ΅ κ΄€λ¦¬ν•λ” μ‹μ¤ν… κµ¬μ¶•

- **ν•µμ‹¬ λ©ν‘:**
    - Append-Only νΈλμ­μ… κΈ°λ° μ„¤κ³„
    - λ©¤λ²„λ³„/κΈ€λ΅λ² ν¬μΈνΈ μ •μ±… μΊμ‹± (Caffeine Cache)
    - ν¬μΈνΈ μ λ¦½, μ λ¦½ μ·¨μ†, μ‚¬μ©, μ‚¬μ© μ·¨μ†, μ¬μ λ¦½(Regrant) μ§€μ›
    - μ •μ±… λ³€κ²½ μ‹ μΊμ‹ μλ™ λ°μ
    - Flyway κΈ°λ° DDL κ΄€λ¦¬

---

## π›  κΈ°μ  μ¤νƒ

| κµ¬λ¶„ | κΈ°μ                                  |
|------|------------------------------------|
| **μ–Έμ–΄** | Java 21                            |
| **ν”„λ μ„μ›ν¬** | Spring Boot 3.5.7, Spring Data JPA |
| **DB** | H2 (λ΅μ»¬ ν…μ¤νΈμ©)                       |
| **λΉλ“ λ„κµ¬** | Gradle 8.14.3                      |
| **λ§μ΄κ·Έλ μ΄μ…** | Flyway                             |
| **μΊμ‹** | Caffeine Cache                     |
| **λ¬Έμ„ν™”** | Swagger (springdoc-openapi)        |
| **λ³΄μ•** | Spring Security + JWT              |

---

## π— μ•„ν‚¤ν…μ² κ°μ”


	β€Ά	Caffeine Cache: λ©¤λ²„λ³„ λ° μ „μ—­ μ •μ±…(pointPolicy) μΊμ‹±
	β€Ά	Flyway: μ΄κΈ° ν…μ΄λΈ” λ° mock λ°μ΄ν„° μλ™ μƒμ„±
	β€Ά	Append-Only κµ¬μ΅°μ point_historyλ΅ λ¨λ“  λ³€κ²½ μ΄λ ¥ μ¶”μ  κ°€λ¥

## π§© λ„λ©”μΈ μ„¤κ³„

| μ—”ν‹°ν‹° | μ„¤λ… |
|--------|------|
| **Member** | νμ› κΈ°λ³Έ μ •λ³΄ λ° μ—­ν• (CUSTOMER, MANAGER) |
| **PointGrant** | ν¬μΈνΈ μ λ¦½(λ¶€μ—¬) LOT λ‹¨μ„ β€” λ§λ£μΌ(expiresAt)κ³Ό μ”μ—¬ ν¬μΈνΈ(remainingAmount) κ΄€λ¦¬ |
| **PointUse** | ν¬μΈνΈ μ‚¬μ© ν—¤λ” β€” μ£Όλ¬Έλ²νΈ λ‹¨μ„ μ‚¬μ© κΈ°λ΅ (orderNo, usedAmount λ“±) |
| **PointUseDetail** | ν¬μΈνΈ μ‚¬μ© μƒμ„Έ β€” κ° μ λ¦½ LOT(PointGrant)λ³„ μ°¨κ° λ‚΄μ—­ |
| **PointCancel** | ν¬μΈνΈ μ‚¬μ© μ·¨μ† λ‚΄μ—­ β€” κΈ°μ΅΄ μ‚¬μ© μƒμ„Έ(PointUseDetail) κΈ°λ°μΌλ΅ λ¶€λ¶„/μ „μ²΄ μ·¨μ† |
| **PointHistory** | λ¨λ“  ν¬μΈνΈ μ΄λ²¤νΈ(GRANT, USE, CANCEL, REGRANT λ“±)μ append-only λ³€κ²½ μ΄λ ¥ |
| **PointPolicy** | ν¬μΈνΈ μ •μ±… μ„¤μ • β€” GLOBAL/νμ›λ³„ μ •μ±… μΊμ‹± (MAX_GRANT_PER_TX, MAX_BALANCE_PER_MEMBER λ“±) |

> κ° μ—”ν‹°ν‹°λ” DDD κΈ°λ°μΌλ΅ μ„¤κ³„λλ©°, λ¨λ“  λ³€κ²½μ€ Append-Only κµ¬μ΅°λ¥Ό λ”°λ¦…λ‹λ‹¤.  
> `PointHistory`λ¥Ό ν†µν•΄ λ¨λ“  μƒνƒ λ³€ν™”λ¥Ό μ¶”μ ν•  μ μμµλ‹λ‹¤.

---

## β™οΈ λΉλ“ λ° μ‹¤ν–‰ λ°©λ²•

### 1οΈβƒ£ μ‚¬μ „ μ”κµ¬μ‚¬ν•­
- JDK **21 μ΄μƒ**
- Gradle **8.x μ΄μƒ**

### 2οΈβƒ£ μ‹¤ν–‰ λ°©λ²•

```bash
# 1. λΉλ“
./gradlew clean build

# 2. μ• ν”λ¦¬μΌ€μ΄μ… μ‹¤ν–‰
./gradlew bootRun
```
3οΈβƒ£ Swagger μ ‘μ†

http://localhost:8080/swagger-ui/index.html


---

## π“΅ API μ£Όμ” κΈ°λ¥

| κµ¬λ¶„ | κΈ°λ¥ | μ„¤λ… |
|------|------|------|
| β… **ν¬μΈνΈ λ¶€μ—¬** | **POST** `/api/v1/points/grant` | ν¬μΈνΈ λ¶€μ—¬ λ° μ •μ±… κ²€μ¦ (1ν μµλ€ μ λ¦½ ν•λ„, λ©¤λ²„λ³„ μƒν•μ•΅ ν™•μΈ) |
| β… **ν¬μΈνΈ μ‚¬μ©** | **POST** `/api/v1/points/use` | λ§λ£μΌ κΈ°μ¤€ FIFO μ°¨κ°, μ‚¬μ© μ΄λ ¥ μƒμ„± λ° μ λ¦½ LOTλ³„ μƒμ„Έ λ§¤ν•‘ |
| β… **ν¬μΈνΈ μ‚¬μ© μ·¨μ†** | **POST** `/api/v1/points/use/cancel` | κΈ°μ΅΄ μ‚¬μ© μƒμ„Έ λ‚΄μ—­(PointUseDetail) κΈ°λ° λ¶€λ¶„/μ „μ²΄ μ·¨μ† |
| β… **ν¬μΈνΈ μ •μ±… κ΄€λ¦¬** | **PUT** `/api/v1/policy/member` | λ©¤λ²„λ³„ λ³΄μ  μƒν• μ •μ±… κ°±μ‹  λ° Caffeine Cache μλ™ λ°μ |
| β… **ν¬μΈνΈ μ΄λ ¥ μ΅°ν** | **GET** `/api/v1/points/history` | Append-only κΈ°λ° λ¨λ“  GRANT/USE/CANCEL/REGRANT λ΅κ·Έ μ΅°ν |

> β™οΈ λ¨λ“  APIλ” JWT κΈ°λ° μΈμ¦ ν›„ μ ‘κ·Ό κ°€λ¥ν•λ©°, Swaggerλ¥Ό ν†µν•΄ ν…μ¤νΈν•  μ μμµλ‹λ‹¤.  
> Swagger μ£Όμ† β†’ [http://localhost:8080/swagger-ui/index.html](http://localhost:8080/swagger-ui/index.html)

---

## π—‚ λ””λ ‰ν† λ¦¬ κµ¬μ΅°
```bash
src/
 β”β”€β”€ main/java/musinsa/points
 β”‚   β”β”€β”€ application/          # μ„λΉ„μ¤ κ³„μΈµ (PointService, PointPolicyService λ“±)
 β”‚   β”β”€β”€ domain/               # μ—”ν‹°ν‹° λ° λ„λ©”μΈ λ΅μ§
 β”‚   β”β”€β”€ infrastructure/       # Repository Adapter, Cache Adapter
 β”‚   β”β”€β”€ presentation/         # Controller (REST API)
 β”‚   β”β”€β”€ common/               # κ³µν†µ μ ν‹Έ, μμ™Έ, λ΅κΉ…, JWT
 β”‚   β””β”€β”€ PointsApplication.java
 β””β”€β”€ main/resources/
     β”β”€β”€ db/migration/         # Flyway SQL μ¤ν¬λ¦½νΈ
     β”β”€β”€ application.yml
     β””β”€β”€ static/swagger/

```
---

## π” ν–¥ν›„ κ°μ„  μ‚¬ν•­

- β… **ν¬μΈνΈ λ§λ£ μ¤μΌ€μ¤„λ¬**
    - Quartz λλ” Spring Batch κΈ°λ°μΌλ΅ λ§λ£ ν¬μΈνΈλ¥Ό μλ™ μ†λ©Έ μ²λ¦¬

- β… **Kafka κΈ°λ° ν¬μΈνΈ μ΄λ²¤νΈ λ΅κ·Έ λΉ„λ™κΈ° μ²λ¦¬**
    - Grant / Use / Cancel / Expire μ΄λ²¤νΈλ¥Ό Kafka ν† ν”½μΌλ΅ λ°ν–‰
    - Audit λ° λ¶„μ„ νμ΄ν”„λΌμΈκ³Ό μ—°λ™

- β… **Redis μΊμ‹ μ „ν™**
    - ν„μ¬ Caffeine Cache β†’ Redisλ΅ λ§μ΄κ·Έλ μ΄μ…
    - λ¶„μ‚° ν™κ²½μ—μ„μ μΊμ‹ μΌκ΄€μ„± ν™•λ³΄

- β… **MSA κµ¬μ΅° ν™•μ¥**
    - `points-service` λ¥Ό μ¤‘μ‹¬μΌλ΅ `policy-service`, `history-service` λ“±μΌλ΅ λ¶„λ¦¬
    - μ„λΉ„μ¤ κ°„ ν†µμ‹ μ€ gRPC λλ” Event κΈ°λ°μΌλ΅ μ „ν™

- β… **PostgreSQL / Aurora μ „ν™**
    - λ΅μ»¬ H2 β†’ PostgreSQL
    - μ΄ν›„ AWS Aurora PostgreSQL ν΄λ¬μ¤ν„° ν™κ²½μΌλ΅ ν™•μ¥

---

## π‘¨β€π’» μ‘μ„±μ

| μ΄λ¦„ | μ—­ν•  | GitHub |
|------|------|--------|
| ν•μ¤€ν¬ | Backend Developer | [github.com/hanjunhui](https://github.com/hanjunhui) |

---

β™οΈ **λ³Έ ν”„λ΅μ νΈλ” Musinsa IT κ³Όμ  κΈ°λ°μΌλ΅ μ μ‘λ λ¬΄λ£ ν¬μΈνΈ κ΄€λ¦¬ μ‹μ¤ν…μ…λ‹λ‹¤.**  
λ„λ©”μΈ μ£Όλ„ μ„¤κ³„(DDD), νΈλμ­μ… λ¬΄κ²°μ„±, μ •μ±… μΊμ‹± κµ¬μ΅°λ¥Ό ν†µν•΄ **μ‹¤λ¬΄ μμ¤€μ μ•μ •μ„±κ³Ό ν™•μ¥μ„±**μ„ μ§€ν–¥ν•©λ‹λ‹¤.  
